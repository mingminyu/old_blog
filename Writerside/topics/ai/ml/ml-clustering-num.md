# 聚类数量

<show-structure depth="2"/>

聚类是数据科学中的一项基本技术，对于揭示数据集中隐藏的模式和结构至关重要。它根据数据点的相似性将数据点分组到集群中，目的是确保同一集群中的项目彼此之间的相关性比其他集群中的项目之间的相关性更紧密。

选择最佳的聚类数量对于聚类算法的成功至关重要，正确的数字可确保模型准确反映底层数据结构，促进富有洞察力的分析和决策。集群太少可能会过度简化数据，从而模糊有意义的区别。相反，太多的聚类可能会过度拟合数据，将噪声视为重要模式，从而使解释变得复杂，并可能导致误导性的结论。

然而，挑战在于如何在不事先了解数据标签的情况下确定最佳簇计数。这就是肘部法和轮廓分析等技术发挥作用的地方。他们提供系统的方法来评估不同的聚类配置，并根据数据的固有特征确定最合适的聚类数量。


## 1. 肘部法

**肘部法**是聚类分析中使用的一种启发式方法，用于确定数据集中的最佳聚类数量。通过将方差绘制为聚类数量的函数，并选择曲线的肘部作为要使用的聚类数量。此方法背后的基本原理是选择较小的 k 值，该值仍然具有较低的平方距离和，当增加超过 k 值的簇数量并不能提供明显降低方差。

### 1.1 计算步骤

- **数据准备**: 首先对数据进行**标准化**，聚类中对数据的标准话
- **计算簇内平方和**: 对于一系列簇数（例如，1 到 10），对数据集应用聚类算法（例如 K 均值）并记录簇内平方和 (WCSS)。
- **绘制曲线**: 在 x 轴上绘制簇数，在 y 轴上绘制相应的 WCSS。
- **识别肘部**: 寻找曲线上 WCSS 开始减慢的点。该点通常称为 “肘部”，表示最佳簇数。
- **验证选择**:（可选）执行其他验证（例如使用轮廓分析）以确认所选聚类数量的适当性。

### 1.2 优点和局限性

优点
: - **简单**: 肘部法易于理解和应用。
: - **可视化**：它提供了集群数量和 WCSS 之间关系的清晰图形表示，有助于决策。

限制
: - **主观性**: “肘部” 的确切位置有时可能是主观的并且可以解释
: - **并不总是清晰**：对于某些数据集，肘部可能不明显，因此很难确定最佳的簇数
: - **性能**: 计算大范围簇数的 WCSS 可能会耗费大量计算资源，尤其是对于大型数据集

## 2. 轮廓分析

轮廓分析是一种用于确定聚类算法有效性的方法，它衡量一个对象与它自己的簇相比于其他簇的相似程度。单个数据点的轮廓系数是使用该点的平均簇内距离 (a) 和平均最近簇距离 (b) 计算的。系数范围从 -1 到 1，其中较高的值表明该点与其自身的簇匹配良好，而与邻近的簇匹配较差，表明该点进行了适当的聚类。

### 2.1 详细步骤

- **计算平均簇内距离** (a): 对于每个点，计算与同一簇内所有其他点的平均距离
- **计算平均最近簇距离** (b): 对于同一点，确定到不同簇中的点的最小平均距离，从而识别其最近的簇
- **计算每个点的轮廓系数** (S): 对数据集中的每个数据点使用公式 S = (b−a)/max(a,b)
- **计算平均轮廓系数**: 找到所有点的平均轮廓系数，以衡量聚类的整体拟合度
- **解释结果**: 较高的平均轮廓系数表示拟合良好的聚类，而较低的分数表示重叠或定义不明确的聚类


### 2.2 与其他方法的优势对比分析：

优点
: - **客观测量**: 与依赖主观视觉检查来确定 “肘” 点的肘部方法不同，轮廓分析提供了聚类有效性的可量化测量
: - **对不同算法的适用性**: 轮廓分析可以应用于任何聚类算法，使其具有多种用途
: - **洞察聚类质量**: 它不仅有助于确定最佳聚类数量，还可以洞察聚类质量，识别任何可能被错误分类的点

限制
: - **计算复杂性**: 轮廓分析可能需要大量计算，尤其是对于大型数据集，因为它需要计算所有点对之间的距离
: - **不明确的情况**: 在簇自然重叠的情况下，轮廓分数可能无法清楚地指示最佳簇数


## 3. 肘部法和轮廓分析的比较

肘部法和轮廓分析对于确保有意义的簇形成都至关重要，但它们采用不同的方法和标准进行验证。了解它们的优点和局限性，有助于为给定的数据集和聚类场景选择最合适的方法。

| 比较   | 肘部法                                           | 轮廓分析                                                                  |
|------|-----------------------------------------------|-----------------------------------------------------------------------|
| 方法   | 根据簇数评估簇内平方和 (WCSS)，WCSS 绘图通常会显示一个“肘”点，表示最佳簇计数 | 衡量一个对象与其他簇相比与其自身簇的相似程度，轮廓系数的范围为 -1 到 1，其中高分表示该对象与其自身的簇匹配良好，而与邻近的簇匹配较差 |
| 优点   | 易于实施和解释，对于跨集群方差显着减少的数据集非常有效                   | 提供对聚类质量更细致的评估，同时考虑内聚性和分离性。轮廓系数是可量化的，提供了更客观的标准                         |
| 局限性  | “肘部”有时可能不明确或不存在，特别是在方差逐渐减少的数据集中               | 大型数据集的计算密集型。当多个聚类具有相似分数时，结果的解释可能会很复杂                                  |
| 最佳用例 | 当簇计数的视觉提示清晰，并且数据集大小对于计算资源而言是可管理时              | 用于详细分析聚类有效性以及计算资源允许进行密集计算时                                            |


对比概述
:- **客观清晰度**: 由于需要直观地识别肘点，肘部方法更加主观，而轮廓分析提供了清晰的数字分数，指示最佳聚类数量
: - **计算效率**: 肘部方法通常速度更快，并且对于大型数据集更具可扩展性，使其适合初始评估。轮廓分析虽然更详细，但需要大量的计算资源来处理大型数据集
: - **模糊数据的适用性**: 轮廓分析在数据未显示清晰肘部的情况下更可取，因为即使最佳簇数并不立即显现，它也可以提供对簇质量和分离的深入了解

在肘部方法和轮廓分析之间进行选择取决于聚类任务的具体要求，包括数据集大小、聚类结构的清晰度、计算资源以及客观与主观验证标准的需要。在实践中，两种方法的结合通常可以提供对最佳聚类方法的全面理解。

## 4. 案例分享

### 4.1 生成数据

这里，我们将使用 sklearn 的 `make_blobs` 函数创建一个示例数据集。

```Python
import matplotlib.pyplot as plt
from sklearn.cluster import KMeans
from sklearn.datasets import make_blobs
from sklearn.metrics import silhouette_score

# 生成 3 个中心的数据点分布
X, _ = make_blobs(n_samples=300, centers=3, cluster_std=0.60, random_state=0)

# Plot the synthetic data
plt.scatter(X[:, 0], X[:, 1], s=50)
plt.title("Synthetic Data")
plt.xlabel("Feature 1")
plt.ylabel("Feature 2")
plt.show()
```

![生成虚拟数据](%myimgs%/clustering_example_1.png?raw=true)

### 4.2 应用肘部法

```Python
wcss = []
for i in range(1, 11):
    kmeans = KMeans(n_clusters=i, init='k-means++', max_iter=300, n_init=10, random_state=0)
    kmeans.fit(X)
    wcss.append(kmeans.inertia_)

# 绘图来进一步观察肘部点
plt.plot(range(1, 11), wcss)
plt.title('Elbow Method')
plt.xlabel('Number of clusters')
plt.ylabel('WCSS')  # Within cluster sum of squares
plt.show()
```

![肘部分析法](%myimgs%/clsutering_example_2.png?raw=true)

从上面  WCSS 图中寻找下降率急剧变化的弯头点，这通常被认为是最佳簇数的指标。从图中可以看到最佳的聚类数量是 3 。


<seealso>
<category ref="ref_docs">
    <a href="https://mp.weixin.qq.com/s/bAVxW0I4owa3F-jfntar-A">选择最佳聚类数量必会的两种方法</a>
</category>
<category ref="ref_github">
</category>
<category ref="ref_issues">
</category>
<category ref="ref_hf">
</category>
<category ref="ref_ms">
</category>
</seealso><show-structure depth="2"/>

